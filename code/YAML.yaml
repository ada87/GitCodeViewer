# GitCode Viewer - CI/CD Configuration (Mock)
# Demonstrates: YAML Syntax, Lists, Dictionaries, Anchors, Aliases

version: '1.0'

# Define reusable anchors
x-environment: &default-env
  NODE_ENV: production
  API_URL: "https://api.gitcodeviewer.com"
  TIMEOUT: 5000

x-cache-steps: &cache-steps
  - name: Restore Cache
    uses: actions/cache@v2
    with:
      path: ~/.npm
      key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

# Workflow Definitions
workflows:
  build-and-test:
    name: Build & Test
    trigger:
      push:
        branches: [ main, develop ]
      pull_request:
        branches: [ main ]
    
    jobs:
      lint:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v2
          
          - name: Setup Node
            uses: actions/setup-node@v2
            with:
              node-version: '18'
              
          - *cache-steps
          
          - name: Install Dependencies
            run: npm ci
            
          - name: Run Linter
            run: npm run lint
            
      test:
        runs-on: ubuntu-latest
        needs: lint
        environment:
          <<: *default-env
          NODE_ENV: test
          
        strategy:
          matrix:
            node-version: [16.x, 18.x, 20.x]
            os: [ubuntu-latest, macos-latest]
            
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            
          - name: Use Node.js ${{ matrix.node-version }}
            uses: actions/setup-node@v2
            with:
              node-version: ${{ matrix.node-version }}
              
          - name: Run Tests
            run: |
              npm ci
              npm test -- --coverage
            
          - name: Upload Coverage
            if: matrix.node-version == '18.x' && matrix.os == 'ubuntu-latest'
            uses: codecov/codecov-action@v2
            
  deploy:
    name: Deploy to Production
    needs: [build-and-test]
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy
        run: ./scripts/deploy.sh
        env:
          <<: *default-env
          API_KEY: ${{ secrets.PROD_API_KEY }}

# Application Configuration (Mock)
app_config:
  name: "GitCode Viewer"
  author: "CodeViewer Team"
  features:
    offline_mode: true
    syntax_highlighting:
      enabled: true
      themes:
        - dracula
        - monokai
        - solarized-dark
      languages:
        - javascript
        - python
        - go
        - rust
        - yaml
        
    git_integration:
      provider: "isomorphic-git"
      cors_proxy: "https://cors.isomorphic-git.org"
      
    ui:
      font_family: "Fira Code"
      font_size: 14
      line_height: 1.5
      show_line_numbers: true
      word_wrap: false

# User Preferences (Default)
user_defaults:
  theme: system
  notifications:
    email: true
    push: true
  sync_frequency: 1h # 1 hour
  ignored_files:
    - ".DS_Store"
    - "Thumbs.db"
    - "node_modules/"
    - "*.log"

# Server Log Configuration
logging:
  level: info
  format: json
  outputs:
    - type: stdout
    - type: file
      path: /var/log/app.log
      rotate:
        max_size: 10MB
        max_files: 5